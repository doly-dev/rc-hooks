"use strict";(self.webpackChunkrc_hooks=self.webpackChunkrc_hooks||[]).push([[6643],{55185:function(c,t,e){var a;e.r(t),e.d(t,{demos:function(){return x}});var y=e(90228),u=e.n(y),g=e(87999),v=e.n(g),r=e(75271),M=e(30713),_=e(56439),p=e(64777),h=e(90674),f=e.n(h),I=e(4841),m=e(36605),x={"useloadmore-demo-loadmore1":{component:r.memo(r.lazy(function(){return e.e(2865).then(e.bind(e,99513))})),asset:{type:"BLOCK",id:"useloadmore-demo-loadmore1",refAtomIds:["useLoadMore"],dependencies:{"index.tsx":{type:"FILE",value:e(23931).Z},react:{type:"NPM",value:"18.3.1"},antd:{type:"NPM",value:"5.23.1"},"rc-hooks":{type:"NPM",value:"3.0.16"},"./services/getUserList.ts":{type:"FILE",value:e(32498).Z},mockjs:{type:"NPM",value:"1.1.0"},ut2:{type:"NPM",value:"1.16.0"}},entry:"index.tsx"},context:{"./services/getUserList.ts":p,react:a||(a=e.t(r,2)),antd:M,"rc-hooks":_,"/home/runner/work/rc-hooks/rc-hooks/src/useLoadMore/demos/services/getUserList.ts":p,mockjs:h,ut2:I},renderOpts:{compile:function(){var d=v()(u()().mark(function i(){var o,l=arguments;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.e(9193).then(e.bind(e,19193));case 2:return n.abrupt("return",(o=n.sent).default.apply(o,l));case 3:case"end":return n.stop()}},i)}));function s(){return d.apply(this,arguments)}return s}()}},"useloadmore-demo-loadmore2":{component:r.memo(r.lazy(function(){return e.e(2865).then(e.bind(e,5288))})),asset:{type:"BLOCK",id:"useloadmore-demo-loadmore2",refAtomIds:["useLoadMore"],dependencies:{"index.tsx":{type:"FILE",value:e(30762).Z},antd:{type:"NPM",value:"5.23.1"},react:{type:"NPM",value:"18.3.1"},"rc-hooks":{type:"NPM",value:"3.0.16"},"./services/getUserList.ts":{type:"FILE",value:e(32498).Z},mockjs:{type:"NPM",value:"1.1.0"},ut2:{type:"NPM",value:"1.16.0"}},entry:"index.tsx"},context:{"./services/getUserList.ts":p,antd:M,react:a||(a=e.t(r,2)),"rc-hooks":_,"/home/runner/work/rc-hooks/rc-hooks/src/useLoadMore/demos/services/getUserList.ts":p,mockjs:h,ut2:I},renderOpts:{compile:function(){var d=v()(u()().mark(function i(){var o,l=arguments;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.e(9193).then(e.bind(e,19193));case 2:return n.abrupt("return",(o=n.sent).default.apply(o,l));case 3:case"end":return n.stop()}},i)}));function s(){return d.apply(this,arguments)}return s}()}},"useloadmore-demo-loadmore3":{component:r.memo(r.lazy(function(){return e.e(2865).then(e.bind(e,80726))})),asset:{type:"BLOCK",id:"useloadmore-demo-loadmore3",refAtomIds:["useLoadMore"],dependencies:{"index.tsx":{type:"FILE",value:e(38050).Z},antd:{type:"NPM",value:"5.23.1"},react:{type:"NPM",value:"18.3.1"},"rc-hooks":{type:"NPM",value:"3.0.16"}},entry:"index.tsx"},context:{antd:M,react:a||(a=e.t(r,2)),"rc-hooks":_},renderOpts:{compile:function(){var d=v()(u()().mark(function i(){var o,l=arguments;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.e(9193).then(e.bind(e,19193));case 2:return n.abrupt("return",(o=n.sent).default.apply(o,l));case 3:case"end":return n.stop()}},i)}));function s(){return d.apply(this,arguments)}return s}()}},"useloadmore-demo-loadmore4":{component:r.memo(r.lazy(function(){return e.e(2865).then(e.bind(e,25607))})),asset:{type:"BLOCK",id:"useloadmore-demo-loadmore4",refAtomIds:["useLoadMore"],dependencies:{"index.tsx":{type:"FILE",value:e(46331).Z},react:{type:"NPM",value:"18.3.1"},"rc-hooks":{type:"NPM",value:"3.0.16"},"./services/search.ts":{type:"FILE",value:e(61068).Z},mockjs:{type:"NPM",value:"1.1.0"},ut2:{type:"NPM",value:"1.16.0"}},entry:"index.tsx"},context:{"./services/search.ts":m,react:a||(a=e.t(r,2)),"rc-hooks":_,"/home/runner/work/rc-hooks/rc-hooks/src/useLoadMore/demos/services/search.ts":m,mockjs:h,ut2:I},renderOpts:{compile:function(){var d=v()(u()().mark(function i(){var o,l=arguments;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.e(9193).then(e.bind(e,19193));case 2:return n.abrupt("return",(o=n.sent).default.apply(o,l));case 3:case"end":return n.stop()}},i)}));function s(){return d.apply(this,arguments)}return s}()}},"useloadmore-demo-loadmore5":{component:r.memo(r.lazy(function(){return e.e(2865).then(e.bind(e,40714))})),asset:{type:"BLOCK",id:"useloadmore-demo-loadmore5",refAtomIds:["useLoadMore"],dependencies:{"index.tsx":{type:"FILE",value:e(35642).Z},react:{type:"NPM",value:"18.3.1"},antd:{type:"NPM",value:"5.23.1"},"rc-hooks":{type:"NPM",value:"3.0.16"},"./services/getUserList.ts":{type:"FILE",value:e(32498).Z},mockjs:{type:"NPM",value:"1.1.0"},ut2:{type:"NPM",value:"1.16.0"}},entry:"index.tsx"},context:{"./services/getUserList.ts":p,react:a||(a=e.t(r,2)),antd:M,"rc-hooks":_,"/home/runner/work/rc-hooks/rc-hooks/src/useLoadMore/demos/services/getUserList.ts":p,mockjs:h,ut2:I},renderOpts:{compile:function(){var d=v()(u()().mark(function i(){var o,l=arguments;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.e(9193).then(e.bind(e,19193));case 2:return n.abrupt("return",(o=n.sent).default.apply(o,l));case 3:case"end":return n.stop()}},i)}));function s(){return d.apply(this,arguments)}return s}()}}}},64777:function(c,t,e){e.r(t),e.d(t,{default:function(){return h}});var a=e(90228),y=e.n(a),u=e(82092),g=e.n(u),v=e(87999),r=e.n(v),M=e(90674),_=e.n(M),p=e(77580);function h(I){return f.apply(this,arguments)}function f(){return f=r()(y()().mark(function I(m){var x,d,s;return y()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return x=m.current,d=m.pageSize,s=d===void 0?5:d,o.next=3,(0,p.Z)();case 3:return o.abrupt("return",_().mock(g()(g()(g()(g()({},"data|".concat(s),[{id:"@guid",name:"@cname","gender|1":["male","female"],email:"@email",disabled:!1}]),"total",15),"errCode","00"),"errMsg","")));case 4:case"end":return o.stop()}},I)})),f.apply(this,arguments)}},36605:function(c,t,e){e.r(t),e.d(t,{default:function(){return h}});var a=e(90228),y=e.n(a),u=e(82092),g=e.n(u),v=e(87999),r=e.n(v),M=e(90674),_=e.n(M),p=e(77580);function h(I){return f.apply(this,arguments)}function f(){return f=r()(y()().mark(function I(m){var x,d,s,i;return y()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return x=m.keyword,d=m.order,s=m.pageNum,i=m.pageSize,console.log(m),l.next=4,(0,p.Z)();case 4:return l.abrupt("return",_().mock(g()({},"list|".concat(s<3?i:i-1),[{text:"keyword='".concat(x,"' order=").concat(d," pageNum=").concat(s," id=@guid")}])));case 5:case"end":return l.stop()}},I)})),f.apply(this,arguments)}},60974:function(c,t,e){e.r(t),e.d(t,{texts:function(){return a}});const a=[{value:"\u57FA\u4E8E ",paraId:0,tocIndex:0},{value:"useAsync",paraId:1,tocIndex:0},{value:" \u6269\u5C55\uFF0C\u7528\u4E8E\u7BA1\u7406",paraId:0,tocIndex:0},{value:"\u52A0\u8F7D\u66F4\u591A",paraId:0,tocIndex:0},{value:"\u7684 Hook\u3002",paraId:0,tocIndex:0},{value:"\u6838\u5FC3\u7279\u6027",paraId:2,tocIndex:0},{value:"\u81EA\u52A8\u7BA1\u7406\u5217\u8868\u6570\u636E\uFF0C\u8FD4\u56DE\u7684 ",paraId:3,tocIndex:0},{value:"data.list",paraId:3,tocIndex:0},{value:" \u4E3A\u5F02\u6B65\u51FD\u6570\u8FD4\u56DE\u7684 ",paraId:3,tocIndex:0},{value:"list",paraId:3,tocIndex:0},{value:" \u5408\u5E76\u6570\u7EC4\u3002",paraId:3,tocIndex:0},{value:"asyncFn",paraId:3,tocIndex:0},{value:" \u7B2C\u4E00\u4E2A\u53C2\u6570\u542B\u5F53\u524D\u9875\u7801 ",paraId:3,tocIndex:0},{value:"current",paraId:3,tocIndex:0},{value:"\u3002",paraId:3,tocIndex:0},{value:"asyncFn",paraId:3,tocIndex:0},{value:" \u8FD4\u56DE\u7684\u6570\u636E\u7ED3\u6784\u5FC5\u987B\u5305\u542B ",paraId:3,tocIndex:0},{value:"{ list: DataItem[] }",paraId:3,tocIndex:0},{value:" \u3002",paraId:3,tocIndex:0},{value:"\u8BBE\u7F6E ",paraId:3,tocIndex:0},{value:"target",paraId:3,tocIndex:0},{value:" \u548C ",paraId:3,tocIndex:0},{value:"isNoMore",paraId:3,tocIndex:0},{value:" \u53EF\u5B9E\u73B0\u4E0A\u62C9\u81EA\u52A8\u52A0\u8F7D\u66F4\u591A\u529F\u80FD\u3002",paraId:3,tocIndex:0},{value:"refreshDeps",paraId:3,tocIndex:0},{value:" \u53D8\u5316\u540E\uFF0C\u4F1A\u5C06 ",paraId:3,tocIndex:0},{value:"current",paraId:3,tocIndex:0},{value:" \u91CD\u7F6E\u4E3A 1 \uFF0C\u5E76\u89E6\u53D1\u5F02\u6B65\u65B9\u6CD5\u3002",paraId:3,tocIndex:0},{value:"\u5728",paraId:3,tocIndex:0},{value:"\u8BF7\u6C42\u5931\u8D25",paraId:3,tocIndex:0},{value:"\u6216",paraId:3,tocIndex:0},{value:"\u53D6\u6D88\u8BF7\u6C42",paraId:3,tocIndex:0},{value:"\u540E\uFF0C\u5982\u679C ",paraId:3,tocIndex:0},{value:"current",paraId:3,tocIndex:0},{value:" \u5927\u4E8E 1\uFF0C\u81EA\u52A8\u51CF 1\uFF0C\u53EF\u4EE5\u91CD\u65B0\u8C03\u7528 ",paraId:3,tocIndex:0},{value:"loadMore",paraId:3,tocIndex:0},{value:" \u91CD\u65B0\u8BF7\u6C42\u3002",paraId:3,tocIndex:0},{value:`const {
  ...,
  loadMore,
  loadingMore,
  noMore
} = useLoadMore(async ({ current }) => ({
    list,
    ...
  }), {
  ...,
  threshold,
  target,
  isNoMore
});
`,paraId:4,tocIndex:7},{value:"\u9664\u4E86\u4EE5\u4E0B\uFF0C\u5176\u5B83\u548C ",paraId:5,tocIndex:7},{value:"useAsync",paraId:6,tocIndex:7},{value:" \u4E00\u6837\u3002",paraId:5,tocIndex:7},{value:"\u53C2\u6570",paraId:7,tocIndex:8},{value:"\u8BF4\u660E",paraId:7,tocIndex:8},{value:"\u7C7B\u578B",paraId:7,tocIndex:8},{value:"loadMore",paraId:7,tocIndex:8},{value:"\u89E6\u53D1\u52A0\u8F7D\u66F4\u591A\u3002",paraId:7,tocIndex:8},{value:"() => void",paraId:7,tocIndex:8},{value:"loadingMore",paraId:7,tocIndex:8},{value:"\u662F\u5426\u6B63\u5728\u52A0\u8F7D\u66F4\u591A\u3002\u5373\u52A0\u8F7D\u4E2D\u5E76\u4E14 ",paraId:7,tocIndex:8},{value:"current",paraId:7,tocIndex:8},{value:" \u4E0D\u7B49\u4E8E ",paraId:7,tocIndex:8},{value:"1",paraId:7,tocIndex:8},{value:"\u3002",paraId:7,tocIndex:8},{value:"boolean",paraId:7,tocIndex:8},{value:"noMore",paraId:7,tocIndex:8},{value:"\u662F\u5426\u6CA1\u6709\u66F4\u591A\u3002",paraId:7,tocIndex:8},{value:"boolean",paraId:7,tocIndex:8},{value:"refresh",paraId:7,tocIndex:8},{value:"\u91CD\u7F6E",paraId:7,tocIndex:8},{value:"current",paraId:7,tocIndex:8},{value:"\u5230\u7B2C ",paraId:7,tocIndex:8},{value:"1",paraId:7,tocIndex:8},{value:" \u9875\uFF0C\u5E76\u6E05\u9664\u4E4B\u524D\u5217\u8868\u6570\u636E\uFF0C\u53D1\u8D77\u8BF7\u6C42\u3002",paraId:7,tocIndex:8},{value:"()=>Promise<R | null>",paraId:7,tocIndex:8},{value:"\u4E0D\u652F\u6301 ",paraId:8,tocIndex:9},{value:"'cacheKey' | 'cacheTime' | 'persisted' | 'pollingInterval' | 'pollingWhenHidden'",paraId:8,tocIndex:9},{value:" \u914D\u7F6E\u9879",paraId:8,tocIndex:9},{value:"\u53C2\u6570",paraId:9,tocIndex:9},{value:"\u8BF4\u660E",paraId:9,tocIndex:9},{value:"\u7C7B\u578B",paraId:9,tocIndex:9},{value:"\u9ED8\u8BA4\u503C",paraId:9,tocIndex:9},{value:"threshold",paraId:9,tocIndex:9},{value:"\u4E0A\u62C9\u81EA\u52A8\u52A0\u8F7D\uFF0C\u8DDD\u79BB\u5E95\u90E8\u8DDD\u79BB\u9608\u503C\u3002",paraId:9,tocIndex:9},{value:"number",paraId:9,tocIndex:9},{value:"100",paraId:9,tocIndex:9},{value:"target",paraId:9,tocIndex:9},{value:"\u5185\u5BB9\u7684\u6EDA\u52A8\u5BB9\u5668\uFF0C\u5982\u679C\u5B58\u5728\uFF0C\u5219\u5728\u6EDA\u52A8\u5230\u5E95\u90E8\u65F6\uFF0C\u81EA\u52A8\u89E6\u53D1 ",paraId:9,tocIndex:9},{value:"loadMore",paraId:9,tocIndex:9},{value:" \u65B9\u6CD5\u3002",paraId:9,tocIndex:9},{value:"HTMLElement | Window | (()=>HTMLElement | Window)",paraId:9,tocIndex:9},{value:"-",paraId:9,tocIndex:9},{value:"isNoMore",paraId:9,tocIndex:9},{value:"\u5224\u65AD\u662F\u5426\u6CA1\u6709\u66F4\u591A\u6570\u636E\u3002",paraId:9,tocIndex:9},{value:"(data?: R) => boolean",paraId:9,tocIndex:9},{value:"-",paraId:9,tocIndex:9},{value:"refreshDeps",paraId:9,tocIndex:9},{value:"\u5728 ",paraId:9,tocIndex:9},{value:"autoRun = true",paraId:9,tocIndex:9},{value:" \u65F6\uFF0CrefreshDeps \u53D8\u5316\uFF0C\u4F1A\u6267\u884C ",paraId:9,tocIndex:9},{value:"refresh",paraId:9,tocIndex:9},{value:" \u3002",paraId:9,tocIndex:9},{value:"any[]",paraId:9,tocIndex:9},{value:"-",paraId:9,tocIndex:9}]},23931:function(c,t){t.Z=`import React from 'react';
import { Button, Spin, List, Typography } from 'antd';
import { useLoadMore } from 'rc-hooks';
import getUserList from './services/getUserList';

function Demo() {
  const { data, loading, loadingMore, noMore, loadMore } = useLoadMore(
    ({ current }) => getUserList({ current }).then((res) => ({ total: res.total, list: res.data })),
    {
      isNoMore: (result) => !!result && result.list.length >= result.total
    }
  );

  return (
    <div>
      <Spin spinning={loading && !loadingMore}>
        <List
          dataSource={data?.list}
          renderItem={(item: { id: string; name: string }) => (
            <List.Item key={item.id}>
              <Typography.Text mark>[{item.id}]</Typography.Text> {item.name}
            </List.Item>
          )}
        />
      </Spin>
      <Button onClick={loadMore} loading={loadingMore} disabled={noMore || loading}>
        {noMore ? 'No more data' : 'Click to load more'}
      </Button>
    </div>
  );
}

export default Demo;
`},30762:function(c,t){t.Z=`import { Button, List } from 'antd';
import React, { useRef } from 'react';
import { useLoadMore } from 'rc-hooks';
import getUserList from './services/getUserList';

function Demo() {
  const containerRef = useRef<HTMLDivElement>(null);
  const { data, loading, loadingMore, refresh, loadMore, noMore } = useLoadMore(
    ({ current }) => {
      return getUserList({ current, pageSize: 3 }).then((res) => ({
        total: res.total,
        list: res.data
      }));
    },
    {
      target: () => containerRef.current,
      isNoMore: (result) => !!result && result.list.length >= result.total
    }
  );

  const renderFooter = () => (
    <div style={{ overflow: 'hidden' }}>
      {!noMore && data?.list && data.list.length > 0 && (
        <Button onClick={loadMore} loading={loadingMore}>
          {loadingMore ? 'Loading more' : 'Click to load more'}
        </Button>
      )}

      {noMore && <span>No more data</span>}

      <span style={{ float: 'right', fontSize: 12 }}>total: {data?.total}</span>
    </div>
  );

  return (
    <div ref={containerRef} style={{ height: 300, overflowY: 'auto' }}>
      <List
        header={
          <Button onClick={refresh} loading={loading}>
            {loading ? 'loading' : 'Reload'}
          </Button>
        }
        footer={renderFooter()}
        loading={loading && !loadingMore}
        bordered
        dataSource={data?.list}
        renderItem={(item: { name: string }) => (
          <List.Item>
            <List.Item.Meta
              title={<a>{item.name}</a>}
              description="rc-hooks is a react hooks library"
            />
          </List.Item>
        )}
      />
    </div>
  );
}

export default Demo;
`},38050:function(c,t){t.Z=`import { Button, List } from 'antd';
import React, { useRef } from 'react';
import { useLoadMore } from 'rc-hooks';

interface Item {
  id?: string;
  name: string;
}

interface Result {
  list: Item[];
  nextId?: string;
}

const resultData = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];

async function getLoadMoreList(nextId: any, limit: any): Promise<Result> {
  let start = 0;
  if (nextId) {
    start = resultData.findIndex((i) => i === nextId);
  }
  const end = start + limit;
  const list = resultData.slice(start, end).map((id) => ({
    id,
    name: \`project \${id} (server time: \${Date.now()})\`
  }));
  const nId = resultData.length >= end ? resultData[end] : undefined;
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve({
        list,
        nextId: nId
      });
    }, 1000);
  });
}

function Demo() {
  const containerRef = useRef<HTMLDivElement>(null);
  const currResult = useRef<Result>();
  const { data, loading, loadingMore, refresh, loadMore, noMore } = useLoadMore(
    ({ current }) => {
      return getLoadMoreList(current === 1 ? undefined : currResult.current?.nextId, 3);
    },
    {
      target: () => containerRef.current,
      isNoMore: (result) => !result?.nextId,
      onSuccess(res) {
        currResult.current = res;
      }
    }
  );

  const renderFooter = () => (
    <div>
      {!noMore && data?.list && data.list.length > 0 && (
        <Button onClick={loadMore} loading={loadingMore}>
          {loadingMore ? 'Loading more' : 'Click to load more'}
        </Button>
      )}

      {noMore && <span>No more data</span>}
    </div>
  );

  return (
    <div ref={containerRef} style={{ height: 300, overflowY: 'auto' }}>
      <List
        header={
          <Button onClick={refresh} loading={loading}>
            {loading ? 'loading' : 'Reload'}
          </Button>
        }
        footer={renderFooter()}
        loading={loading && !loadingMore}
        bordered
        dataSource={data?.list}
        renderItem={(item: { name: string }) => (
          <List.Item>
            <List.Item.Meta title={<a>{item.name}</a>} />
          </List.Item>
        )}
      />
    </div>
  );
}

export default Demo;
`},46331:function(c,t){t.Z=`import * as React from 'react';
import { useLoadMore, useDebounce } from 'rc-hooks';
import search from './services/search';

// \u6392\u5E8F
const orderTypes = [
  {
    name: '\u7EFC\u5408',
    value: 1
  },
  {
    name: '\u9500\u91CF',
    value: 2
  },
  {
    name: '\u4EF7\u683C',
    value: 3
  }
];

const DefaultPageSize = 3;

function Demo() {
  const [keyword, setKeyword] = React.useState('');
  const [order, setOrder] = React.useState(orderTypes[0].value);
  const debounceKeyword = useDebounce(keyword, 500);
  const containerRef = React.useRef<HTMLDivElement>(null);

  const { data, loadMore, noMore, loading, loadingMore } = useLoadMore(
    ({ current }) => {
      return search({
        pageNum: current,
        pageSize: DefaultPageSize,
        keyword: debounceKeyword,
        order
      }).then((res) => ({
        list: res.list,
        prevListLen: res.list.length
      }));
    },
    {
      target: () => containerRef.current,
      isNoMore: (result) => !!result?.prevListLen && result.prevListLen < DefaultPageSize,
      refreshDeps: [debounceKeyword, order]
    }
  );

  return (
    <div>
      <input
        type="text"
        placeholder="\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD"
        value={keyword}
        onChange={(e) => setKeyword(e.target.value)}
      />
      <div className="orderList">
        {orderTypes.map((item) => (
          <a
            key={item.value}
            style={order === item.value ? { color: 'red' } : {}}
            onClick={() => {
              setOrder(item.value);
            }}
          >
            {item.name}
          </a>
        ))}
      </div>
      <div style={{ height: 150, overflowY: 'auto' }} ref={containerRef}>
        {loading && !loadingMore && '\u641C\u7D22\u4E2D...'}
        {noMore &&
          !loading &&
          data?.list &&
          data.list.length <= 0 &&
          \`\u6CA1\u6709\u627E\u5230 \u201C\${debounceKeyword}\u201D \u76F8\u5173\u6570\u636E\`}
        {data?.list && data.list.length > 0 && (
          <div>
            <ol>
              {data.list.map((item) => (
                <li key={item.text}>{item.text}</li>
              ))}
            </ol>
            {!noMore && (
              <button onClick={loadMore} disabled={loadingMore}>
                {loadingMore ? '\u6B63\u5728\u52A0\u8F7D...' : '\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A'}
              </button>
            )}
            {noMore && !loadingMore && '\u6CA1\u6709\u66F4\u591A\u6570\u636E'}
          </div>
        )}
      </div>
    </div>
  );
}

export default Demo;
`},35642:function(c,t){t.Z=`import React from 'react';
import { Button, Spin, List, Typography } from 'antd';
import { useLoadMore } from 'rc-hooks';
import getUserList from './services/getUserList';

function Demo() {
  const { data, loading, loadingMore, noMore, loadMore, mutate } = useLoadMore(
    ({ current }) => getUserList({ current }).then((res) => ({ total: res.total, list: res.data })),
    {
      isNoMore: (result) => !!result && result.list.length >= result.total
    }
  );

  const removeItem = (id: string) => {
    mutate((d) => {
      const index = d.list.findIndex((item) => item.id === id);
      const newList = d.list.slice();
      newList.splice(index, 1);

      if (index !== -1) {
        return {
          ...d,
          total: d.total - 1,
          list: newList
        };
      }

      return d;
    });
  };

  return (
    <div>
      <Spin spinning={loading && !loadingMore}>
        <List
          dataSource={data?.list}
          renderItem={(item: { id: string; name: string }) => (
            <List.Item
              key={item.id}
              actions={[
                <a key="delete" onClick={() => removeItem(item.id)}>
                  \u5220\u9664
                </a>
              ]}
            >
              <Typography.Text mark>[{item.id}]</Typography.Text> {item.name}
            </List.Item>
          )}
        />
      </Spin>
      <Button onClick={loadMore} loading={loadingMore} disabled={noMore || loading}>
        {noMore ? 'No more data' : 'Click to load more'}
      </Button>
    </div>
  );
}

export default Demo;
`},32498:function(c,t){t.Z=`/* eslint-disable @typescript-eslint/no-unused-vars */
import Mock from 'mockjs';
import { sleep } from 'ut2';

type DataItem = {
  id: string;
  name: string;
  gender: 'male' | 'female';
  email: string;
  disabled: boolean;
};

type Result = {
  data: DataItem[];
  total: number;
  errCode: string;
  errMsg: string;
};

export default async function getUserList({
  current,
  pageSize = 5
}: {
  current: number;
  pageSize?: number;
}) {
  await sleep();
  return Mock.mock({
    [\`data|\${pageSize}\`]: [
      {
        id: '@guid',
        name: '@cname',
        'gender|1': ['male', 'female'],
        email: '@email',
        disabled: false
      }
    ],
    total: 15,
    errCode: '00',
    errMsg: ''
  }) as Result;
}
`},61068:function(c,t){t.Z=`import Mockjs from 'mockjs';
import { sleep } from 'ut2';

type DataItem = {
  text: string;
};

type Result = {
  list: DataItem[];
};

export default async function search(params: {
  keyword: string;
  order: number;
  pageNum: number;
  pageSize: number;
}) {
  const { keyword, order, pageNum, pageSize } = params;
  console.log(params);

  await sleep();

  return Mockjs.mock({
    [\`list|\${pageNum < 3 ? pageSize : pageSize - 1}\`]: [
      {
        text: \`keyword='\${keyword}' order=\${order} pageNum=\${pageNum} id=@guid\`
      }
    ]
  }) as Result;
}
`}}]);
